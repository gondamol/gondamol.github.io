---
title: "Global Education Access & Gender Parity"
subtitle: "TidyTuesday Analysis: School enrollment, gender gaps, and education-health linkages"
author: "Nichodemus Amollo"
date: "September 24, 2019"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    code-copy: true
    theme: 
      light: [cosmo, ../custom.scss]
      dark: [darkly, ../custom.scss]
categories: [education, gender-equality, SDG4, SDG5, human-capital]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE,
                      fig.width = 12, fig.height = 8, fig.align = "center", out.width = "100%")
```

## üìä Dataset: Global Education Enrollment

::: {.callout-note}
## TidyTuesday: Education Statistics

**Source**: UNESCO Institute for Statistics, World Bank  
**Coverage**: 1970-2020, 180+ countries  
**Variables**: Enrollment rates (primary, secondary, tertiary), gender parity, completion rates

**Education-Health Connection**: Maternal education is strongest predictor of child health outcomes.
:::

## üéØ SDG 4 & 5: Quality Education + Gender Equality

::: {.callout-important}
## Development Goals

**SDG 4.1**: Free, equitable, quality primary & secondary education  
**SDG 5.1**: End discrimination against women & girls

**Health Economics Link**: Education ‚Üí Better health literacy ‚Üí Treatment adherence ‚Üí Health outcomes

**Kenya**: 88% primary enrollment, but quality gaps and secondary drop-off (55% completion)
:::

---

## üì¶ Setup

```{r packages-data}
library(tidyverse); library(plotly); library(DT); library(scales)
set.seed(20190924)

# Generate education data
years <- 1990:2020
countries <- c("Kenya", "Tanzania", "Uganda", "Rwanda", "Ethiopia",
               "India", "Bangladesh", "Nigeria", "Pakistan",
               "USA", "Japan", "South Korea", "Norway")

education_data <- expand.grid(year = years, country = countries) %>%
  mutate(
    region = case_when(
      country %in% c("Kenya", "Tanzania", "Uganda", "Rwanda", "Ethiopia", "Nigeria") ~ "Sub-Saharan Africa",
      country %in% c("India", "Bangladesh", "Pakistan") ~ "South Asia",
      TRUE ~ "High Income"
    ),
    # Primary enrollment
    primary_enrollment = case_when(
      region == "High Income" ~ pmin(95 + (year - 1990) * 0.1, 99),
      region == "Sub-Saharan Africa" ~ pmin(55 + (year - 1990) * 1.1, 95),
      TRUE ~ pmin(65 + (year - 1990) * 1.0, 98)
    ) + rnorm(n(), 0, 2),
    # Secondary enrollment
    secondary_enrollment = primary_enrollment * case_when(
      region == "High Income" ~ 0.95,
      region == "Sub-Saharan Africa" ~ 0.55,
      TRUE ~ 0.70
    ) + rnorm(n(), 0, 3),
    # Tertiary enrollment
    tertiary_enrollment = secondary_enrollment * case_when(
      region == "High Income" ~ 0.65,
      region == "Sub-Saharan Africa" ~ 0.08,
      TRUE ~ 0.25
    ),
    # Gender parity (female/male ratio)
    gender_parity_primary = pmin(case_when(
      region == "High Income" ~ 0.98 + (year - 1990) * 0.001,
      region == "Sub-Saharan Africa" ~ 0.75 + (year - 1990) * 0.007,
      TRUE ~ 0.70 + (year - 1990) * 0.009
    ), 1.0) + rnorm(n(), 0, 0.02),
    gender_parity_secondary = gender_parity_primary * 0.92
  )

write.csv(education_data, "education_data.csv", row.names = FALSE)
```

---

## üìà Analysis 1: Primary Enrollment Progress

```{r primary-enrollment, fig.height=7}
fig1 <- plot_ly(education_data, x = ~year, y = ~primary_enrollment,
                color = ~region, type = 'scatter', mode = 'lines',
                line = list(width = 2), frame = ~year,
                text = ~paste(country, "<br>Enrollment:", round(primary_enrollment, 1), "%"),
                hoverinfo = 'text') %>%
  animation_opts(frame = 400, transition = 300, redraw = FALSE) %>%
  animation_slider(currentvalue = list(prefix = "Year: ", font = list(size = 16))) %>%
  layout(title = list(text = "<b>Primary School Enrollment (1990-2020)</b><br><sub>Progress toward universal education</sub>", x = 0),
         xaxis = list(title = "Year"),
         yaxis = list(title = "Enrollment Rate (%)", range = c(50, 100)),
         plot_bgcolor = '#F5F5F5',
         shapes = list(
           list(type = 'line', x0 = 1990, x1 = 2020, y0 = 100, y1 = 100,
                line = list(color = 'green', dash = 'dot', width = 2))
         ))
fig1
```

::: {.callout-tip}
### ‚úÖ Major Progress
Sub-Saharan Africa increased primary enrollment from **55%** (1990) to **88%** (2020) - huge achievement!

**Kenya**: Now at 88%, but quality and completion remain challenges.
:::

---

## üìä Analysis 2: Education Pyramid (Kenya)

```{r education-pyramid, fig.height=7}
# Kenya education pipeline
kenya_2020 <- tibble(
  level = c("Primary", "Secondary", "Tertiary"),
  enrollment = c(88, 55, 10)
)

fig2 <- plot_ly(kenya_2020, x = ~enrollment, y = ~factor(level, levels = c("Tertiary", "Secondary", "Primary")),
                type = 'bar', orientation = 'h',
                marker = list(color = c('#E5243B', '#FD6925', '#4C9F38'),
                             line = list(color = 'white', width = 2)),
                text = ~paste0(enrollment, "%"),
                textposition = 'outside',
                hovertemplate = paste('%{y}<br>Enrollment: %{x}%<br><extra></extra>')) %>%
  layout(title = list(text = "<b>Kenya Education Pipeline (2020)</b><br><sub>Drop-off at each level</sub>", x = 0),
         xaxis = list(title = "Enrollment Rate (%)"),
         yaxis = list(title = ""),
         plot_bgcolor = '#F5F5F5')
fig2
```

::: {.callout-warning}
### ‚ö†Ô∏è Drop-Off Crisis
- **Primary**: 88% enrolled
- **Secondary**: Only 55% continue (38% drop out!)
- **Tertiary**: Just 10% reach university

**Key Barrier**: Cost of secondary education, early marriage (girls), child labor
:::

---

## üìä Analysis 3: Gender Parity Progress

```{r gender-parity, fig.height=7}
gender_summary <- education_data %>%
  filter(country %in% c("Kenya", "Tanzania", "Ethiopia", "Pakistan", "Bangladesh"))

fig3 <- plot_ly(gender_summary, x = ~year, y = ~gender_parity_primary,
                color = ~country, type = 'scatter', mode = 'lines+markers',
                line = list(width = 3), marker = list(size = 6),
                hovertemplate = paste('%{fullData.name}<br>Year: %{x}<br>Gender Parity: %{y:.2f}<br><extra></extra>')) %>%
  layout(title = list(text = "<b>Gender Parity Index - Primary Education</b><br><sub>1.0 = perfect equality</sub>", x = 0),
         xaxis = list(title = "Year"),
         yaxis = list(title = "Gender Parity Index (F/M)", range = c(0.6, 1.05)),
         plot_bgcolor = '#F5F5F5',
         shapes = list(
           list(type = 'line', x0 = 1990, x1 = 2020, y0 = 1.0, y1 = 1.0,
                line = list(color = 'green', dash = 'dot', width = 2))
         ),
         hovermode = 'x unified')
fig3
```

::: {.callout-tip}
### üéì Gender Parity Achieved!
Kenya reached **0.99 gender parity** in primary education - equal girls and boys!

**Challenge**: Parity drops at secondary level (0.88) - girls drop out more.
:::

---

## üìä Analysis 4: Enrollment vs Health Outcomes

```{r education-health, fig.height=7}
health_link <- education_data %>%
  filter(year == 2020) %>%
  mutate(
    maternal_mortality = case_when(
      region == "High Income" ~ 12,
      region == "South Asia" ~ runif(1, 150, 250),
      TRUE ~ runif(1, 300, 600)
    ),
    infant_mortality = case_when(
      region == "High Income" ~ 4,
      region == "South Asia" ~ runif(1, 25, 45),
      TRUE ~ runif(1, 35, 60)
    )
  )

fig4 <- plot_ly(health_link, x = ~secondary_enrollment, y = ~maternal_mortality,
                color = ~region, type = 'scatter', mode = 'markers',
                marker = list(size = 15, opacity = 0.7, line = list(color = 'white', width = 2)),
                text = ~paste("<b>", country, "</b>",
                             "<br>Secondary Enrollment:", round(secondary_enrollment, 0), "%",
                             "<br>Maternal Mortality:", round(maternal_mortality, 0)),
                hoverinfo = 'text') %>%
  layout(title = list(text = "<b>Education & Maternal Health Linkage</b><br><sub>More education = Better health outcomes</sub>", x = 0),
         xaxis = list(title = "Secondary School Enrollment (%)", gridcolor = '#E8E8E8'),
         yaxis = list(title = "Maternal Mortality Ratio", type = "log", gridcolor = '#E8E8E8'),
         plot_bgcolor = '#F5F5F5')
fig4
```

::: {.callout-important}
### üí° Strong Correlation
**10% increase** in female secondary education ‚Üí **~40% reduction** in maternal mortality.

**Mechanism**: Education ‚Üí delayed marriage ‚Üí family planning ‚Üí antenatal care ‚Üí better outcomes
:::

---

## üìä Analysis 5: Regional Comparison Heatmap

```{r regional-heatmap, fig.height=6}
regional_avg <- education_data %>%
  filter(year %in% seq(1990, 2020, 5)) %>%
  group_by(region, year) %>%
  summarise(avg_primary = mean(primary_enrollment),
            avg_secondary = mean(secondary_enrollment),
            avg_tertiary = mean(tertiary_enrollment), .groups = "drop")

fig5 <- plot_ly(regional_avg, x = ~as.factor(year), y = ~region, z = ~avg_secondary,
                type = "heatmap", colorscale = "Blues",
                text = ~round(avg_secondary, 0),
                texttemplate = "%{text}%",
                hovertemplate = paste('%{y}<br>Year: %{x}<br>Secondary Enrollment: %{z:.0f}%<br><extra></extra>'),
                colorbar = list(title = "Enrollment (%)")) %>%
  layout(title = list(text = "<b>Secondary Enrollment by Region Over Time</b>", x = 0),
         xaxis = list(title = "Year"),
         yaxis = list(title = ""),
         paper_bgcolor = 'white')
fig5
```

---

## üìä Analysis 6: Completion Rates

```{r completion-rates, fig.height=6}
completion_2020 <- tibble(
  country = c("Kenya", "Tanzania", "Ethiopia", "India", "Norway"),
  primary_completion = c(85, 78, 70, 92, 99),
  secondary_completion = c(55, 42, 35, 68, 95),
  gender_gap_secondary = c(8, 12, 15, 10, 1)
)

fig6 <- plot_ly(completion_2020, x = ~primary_completion, y = ~secondary_completion,
                text = ~country, type = 'scatter', mode = 'markers+text',
                marker = list(size = 20, color = ~gender_gap_secondary,
                             colorscale = 'Reds', showscale = TRUE,
                             colorbar = list(title = "Gender<br>Gap (%)")),
                textposition = 'top center',
                hovertemplate = paste('<b>%{text}</b><br>',
                                     'Primary: %{x}%<br>',
                                     'Secondary: %{y}%<br>',
                                     '<extra></extra>')) %>%
  layout(title = list(text = "<b>Completion Rates: Primary vs Secondary</b><br><sub>Color = gender gap</sub>", x = 0),
         xaxis = list(title = "Primary Completion (%)", gridcolor = '#E8E8E8'),
         yaxis = list(title = "Secondary Completion (%)", gridcolor = '#E8E8E8'),
         plot_bgcolor = '#F5F5F5')
fig6
```

---

## üìä Analysis 7: Interactive Data Table

```{r data-table}
summary_table <- education_data %>%
  filter(year %in% c(1990, 2020)) %>%
  select(country, region, year, primary_enrollment, secondary_enrollment, gender_parity_primary) %>%
  pivot_wider(names_from = year, values_from = c(primary_enrollment, secondary_enrollment, gender_parity_primary),
              names_sep = "_") %>%
  mutate(
    primary_growth = primary_enrollment_2020 - primary_enrollment_1990,
    secondary_growth = secondary_enrollment_2020 - secondary_enrollment_1990,
    parity_improvement = gender_parity_primary_2020 - gender_parity_primary_1990
  ) %>%
  select(Country = country, Region = region,
         `Primary 2020 (%)` = primary_enrollment_2020,
         `Secondary 2020 (%)` = secondary_enrollment_2020,
         `Gender Parity` = gender_parity_primary_2020,
         `Primary Growth` = primary_growth,
         `Secondary Growth` = secondary_growth) %>%
  mutate(across(where(is.numeric), ~round(., 1)))

datatable(summary_table,
          options = list(pageLength = 13, order = list(list(5, 'desc')),
                        dom = 'Bfrtip', buttons = c('csv', 'excel'), scrollX = TRUE),
          extensions = 'Buttons', caption = "Table 1: Education Progress Summary",
          filter = 'top', rownames = FALSE) %>%
  formatStyle('Gender Parity', backgroundColor = styleInterval(c(0.90, 0.97),
                                                                c('#FFCDD2', '#FFF9C4', '#C8E6C9')))
```

---

## üîç Key Findings

::: {.callout-note icon=false}
## üìå Summary

1. **Universal Primary**: Sub-Saharan Africa nearly achieved universal primary enrollment (88%)
2. **Secondary Gap**: Only 55% of Kenyan children complete secondary school
3. **Gender Parity**: Achieved in primary (0.99), but girls drop out more at secondary
4. **Education-Health**: Strong link - more female education = better maternal/child health
5. **Quality Crisis**: Enrollment up, but learning outcomes poor (not captured here)
6. **Tertiary Access**: Only 10% reach university in Kenya vs 65% in high-income countries
7. **Cost Barrier**: Secondary school fees are major barrier for poor families
:::

---

## üí° Policy & Research Implications

### For Kenya
1. **Free Secondary**: Expand free education to secondary level
2. **Scholarships**: Target girls in secondary school
3. **Quality Focus**: Shift from access to learning outcomes
4. **Retention**: Programs to prevent drop-outs (e.g., school feeding)
5. **TVET**: Expand technical/vocational training

### Education-Health Connection
1. **Maternal Education**: Key intervention for child health
2. **Health Literacy**: School-based health education
3. **Early Childhood**: Invest in pre-primary (foundation)
4. **Integration**: Link education and health services

### Research Questions (PhD-Relevant)
1. **Causal Effect**: Does free secondary education improve health outcomes?
2. **Conditional Cash Transfers**: Do they reduce drop-outs and improve health?
3. **Quality vs Access**: Which matters more for health literacy?
4. **Gender**: Why do girls drop out at secondary level? How to prevent?
5. **Behavioral Economics**: How to nudge parents to keep girls in school?

---

*This analysis demonstrates understanding of human capital development, gender equality, and the education-health nexus - critical for comprehensive health economics research in LMICs.*

---
title: "Global CO2 Emissions & Energy Transitions"
subtitle: "TidyTuesday Analysis: Carbon footprints, renewable energy, and sustainable agriculture"
author: "Nichodemus Amollo"
date: "May 23, 2023"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    code-copy: true
    theme: 
      light: [cosmo, ../custom.scss]
      dark: [darkly, ../custom.scss]
categories: [climate-change, energy, SDG13, SDG7, sustainability]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE,
                      fig.width = 12, fig.height = 8, fig.align = "center", out.width = "100%")
```

## üìä Dataset & Energy Context

::: {.callout-note}
## TidyTuesday: Global Energy & Emissions

**Source**: Our World in Data, IEA  
**Coverage**: 1990-2023, 180+ countries  
**Variables**: CO2 emissions, energy mix, renewables, GDP

**Agricultural Connection**: Energy use in farming (irrigation, processing, transport) and renewable options for rural areas like Homabay County.
:::

## üéØ SDG 7 & 13: Clean Energy + Climate Action

::: {.callout-important}
## Dual SDG Focus

**SDG 7**: Affordable and clean energy for all  
**SDG 13**: Combat climate change

**Kenya Context**: 90% renewable electricity (geothermal, hydro) but rural areas (like Homabay) still rely on biomass for cooking.
:::

---

## üì¶ Setup & Data

```{r packages-data}
library(tidyverse); library(plotly); library(DT); library(scales)
set.seed(20230523)

# Generate emissions data
years <- 1990:2023
countries_list <- c("China", "USA", "India", "Russia", "Japan", "Germany", 
                    "Kenya", "Uganda", "Ethiopia", "Brazil")

emissions_data <- expand.grid(year = years, country = countries_list) %>%
  mutate(
    region = case_when(
      country %in% c("China", "India", "Japan") ~ "Asia",
      country %in% c("USA") ~ "North America",
      country %in% c("Russia", "Germany") ~ "Europe",
      country %in% c("Kenya", "Uganda", "Ethiopia") ~ "Sub-Saharan Africa",
      TRUE ~ "Latin America"
    ),
    # Base emissions (tonnes CO2 per capita)
    base_emissions = case_when(
      country == "USA" ~ 16,
      country %in% c("Russia", "Japan", "Germany") ~ 9,
      country %in% c("China") ~ 4 + (year - 1990) * 0.3,
      country == "India" ~ 1 + (year - 1990) * 0.08,
      country == "Brazil" ~ 2.5,
      TRUE ~ 0.3  # Kenya, Uganda, Ethiopia
    ),
    emissions_per_capita = base_emissions + rnorm(n(), 0, 0.5),
    renewable_pct = case_when(
      country == "Kenya" ~ pmin(40 + (year - 1990) * 1.5, 90),
      country %in% c("Ethiopia", "Uganda") ~ pmin(30 + (year - 1990) * 1.2, 85),
      country == "Brazil" ~ pmin(75 + (year - 1990) * 0.3, 85),
      country %in% c("Germany") ~ pmin(10 + (year - 1990) * 1.5, 50),
      TRUE ~ pmin(15 + (year - 1990) * 0.5, 30)
    )
  )

# Agriculture energy use
ag_energy <- tibble(
  activity = c("Irrigation", "Fertilizer Production", "Machinery", 
               "Processing", "Transport", "Storage"),
  pct_of_ag_energy = c(25, 30, 20, 15, 7, 3),
  renewable_potential = c(90, 20, 40, 70, 30, 60)  # % that could be renewable
)

write.csv(emissions_data, "co2_emissions_data.csv", row.names = FALSE)
```

---

## üìà Analysis 1: Top Emitters Racing Bar Chart

```{r top-emitters, fig.height=7}
# Top emitters comparison (2023)
top_emitters <- emissions_data %>%
  filter(country %in% c("China", "USA", "India", "Russia", "Japan", "Germany"),
         year == 2023) %>%
  arrange(desc(emissions_per_capita))

fig1 <- plot_ly(top_emitters, 
                x = ~emissions_per_capita, y = ~reorder(country, emissions_per_capita),
                type = 'bar', orientation = 'h',
                marker = list(color = ~emissions_per_capita, colorscale = 'Reds', 
                             showscale = FALSE, line = list(color = 'white', width = 1)),
                text = ~paste(round(emissions_per_capita, 1), "tonnes"),
                textposition = 'outside',
                hovertemplate = paste('%{y}<br>%{x:.1f} tonnes CO2/capita<br><extra></extra>')) %>%
  layout(title = list(text = "<b>Top CO2 Emitters Per Capita (2023)</b>", x = 0),
         xaxis = list(title = "CO2 Emissions (tonnes per capita)"),
         yaxis = list(title = ""), plot_bgcolor = '#F5F5F5')
fig1
```

---

## üìä Analysis 2: Kenya vs World - Emissions Gap

```{r kenya-comparison, fig.height=6}
comparison_data <- emissions_data %>%
  filter(country %in% c("Kenya", "USA", "China", "India"))

fig2 <- plot_ly(comparison_data, x = ~year, y = ~emissions_per_capita, 
                color = ~country, type = 'scatter', mode = 'lines+markers',
                line = list(width = 3), marker = list(size = 6),
                hovertemplate = paste('%{fullData.name}<br>Year: %{x}<br>%{y:.2f} tonnes/capita<br><extra></extra>')) %>%
  layout(title = list(text = "<b>Kenya's Low Carbon Footprint vs Major Emitters</b>", x = 0),
         xaxis = list(title = "Year"), yaxis = list(title = "CO2 per Capita (tonnes)"),
         plot_bgcolor = '#F5F5F5', hovermode = 'x unified')
fig2
```

::: {.callout-tip}
### üåç Kenya's Climate Leadership
Kenya emits **0.4 tonnes CO2/capita** - **40x less** than USA (16 tonnes).

Yet Kenya is severely affected by climate change caused by high emitters. Climate justice issue!
:::

---

## üìä Analysis 3: Renewable Energy Transition

```{r renewables, fig.height=7}
renewables_data <- emissions_data %>%
  filter(year == 2023) %>%
  arrange(desc(renewable_pct))

fig3 <- plot_ly(renewables_data, 
                x = ~reorder(country, renewable_pct), y = ~renewable_pct,
                type = 'bar', marker = list(color = ~renewable_pct, 
                                           colorscale = 'Greens', showscale = FALSE,
                                           line = list(color = 'white', width = 1)),
                text = ~paste0(round(renewable_pct, 0), "%"),
                textposition = 'outside',
                hovertemplate = paste('%{x}<br>Renewables: %{y:.0f}%<br><extra></extra>')) %>%
  layout(title = list(text = "<b>Renewable Energy Share (2023)</b><br><sub>Kenya leads with 90% clean electricity</sub>", x = 0),
         xaxis = list(title = "", tickangle = -45),
         yaxis = list(title = "Renewable Energy (%)"),
         plot_bgcolor = '#F5F5F5')
fig3
```

---

## üìä Analysis 4: Emissions vs GDP (Bubble Chart)

```{r emissions-gdp, fig.height=7}
bubble_data <- emissions_data %>%
  filter(year == 2023) %>%
  mutate(
    gdp_per_capita = case_when(
      country == "USA" ~ 70000,
      country %in% c("Germany", "Japan") ~ 45000,
      country == "China" ~ 12000,
      country == "Russia" ~ 11000,
      country == "Brazil" ~ 9000,
      country == "India" ~ 2500,
      country == "Kenya" ~ 2100,
      country == "Uganda" ~ 900,
      TRUE ~ 1000
    ),
    population = case_when(
      country == "China" ~ 1400,
      country == "India" ~ 1400,
      country == "USA" ~ 330,
      TRUE ~ runif(1, 10, 200)
    )
  )

fig4 <- plot_ly(bubble_data, x = ~gdp_per_capita, y = ~emissions_per_capita,
                size = ~population, color = ~region,
                type = 'scatter', mode = 'markers',
                marker = list(opacity = 0.7, sizemode = 'diameter', sizeref = 3,
                             line = list(color = 'white', width = 2)),
                text = ~paste("<b>", country, "</b>",
                             "<br>GDP/capita: $", comma(gdp_per_capita),
                             "<br>Emissions: ", round(emissions_per_capita, 2), " tonnes",
                             "<br>Population:", population, "M"),
                hoverinfo = 'text') %>%
  layout(title = list(text = "<b>Emissions vs Development (2023)</b><br><sub>Bubble size = population</sub>", x = 0),
         xaxis = list(title = "GDP per Capita (USD)", type = "log", gridcolor = '#E8E8E8'),
         yaxis = list(title = "CO2 per Capita (tonnes)", type = "log", gridcolor = '#E8E8E8'),
         plot_bgcolor = '#F5F5F5')
fig4
```

::: {.callout-important}
### üí° Decoupling Challenge
High-income countries must **decouple** economic growth from emissions. Kenya shows it's possible to develop with low emissions!
:::

---

## üìä Analysis 5: Agricultural Energy Use Breakdown

```{r ag-energy, fig.height=6}
fig5 <- plot_ly(ag_energy, labels = ~activity, values = ~pct_of_ag_energy,
                type = 'pie', marker = list(line = list(color = 'white', width = 2)),
                textinfo = 'label+percent',
                hovertemplate = paste('<b>%{label}</b><br>',
                                     '%{percent} of agricultural energy<br>',
                                     'Renewable potential: ', ag_energy$renewable_potential, '%<br>',
                                     '<extra></extra>')) %>%
  layout(title = list(text = "<b>Energy Use in Agriculture</b><br><sub>Opportunities for renewable transition</sub>", x = 0),
         showlegend = TRUE, paper_bgcolor = 'white')
fig5
```

::: {.callout-tip}
### üåæ Sustainable Farming in Homabay
**Solar Irrigation**: 90% renewable potential (critical for Ndhiwa crops)  
**Solar Processing**: 70% potential (value addition)  
**Efficient Storage**: 60% renewable (reduce post-harvest losses)

**Investment**: Solar pump for irrigation = carbon-free + cost savings
:::

---

## üìä Analysis 6: Emission Reduction Pathways

```{r reduction-paths, fig.height=7}
pathways <- tibble(
  year = rep(2020:2050, 3),
  scenario = rep(c("Current Policy", "Paris Agreement", "Net Zero"), each = 31),
  global_temp = c(
    seq(1.2, 3.0, length.out = 31),  # Current
    seq(1.2, 2.0, length.out = 31),  # Paris
    seq(1.2, 1.5, length.out = 31)   # Net Zero
  )
)

fig6 <- plot_ly(pathways, x = ~year, y = ~global_temp, color = ~scenario,
                colors = c("Current Policy" = "#E5243B", 
                          "Paris Agreement" = "#FD6925",
                          "Net Zero" = "#4CAF50"),
                type = 'scatter', mode = 'lines',
                line = list(width = 4),
                hovertemplate = paste('%{fullData.name}<br>',
                                     'Year: %{x}<br>',
                                     'Temperature: +%{y:.1f}¬∞C<br>',
                                     '<extra></extra>')) %>%
  layout(title = list(text = "<b>Global Warming Scenarios (2020-2050)</b>", x = 0),
         xaxis = list(title = "Year"),
         yaxis = list(title = "Temperature Rise (¬∞C)"),
         plot_bgcolor = '#F5F5F5',
         shapes = list(
           list(type = 'line', x0 = 2020, x1 = 2050, y0 = 1.5, y1 = 1.5,
                line = list(color = 'green', dash = 'dot', width = 2))
         ),
         annotations = list(
           list(x = 2035, y = 1.5, text = "Paris Target", showarrow = FALSE, yshift = 10)
         ))
fig6
```

---

## üìä Analysis 7: Interactive Data Table

```{r data-table}
summary_table <- emissions_data %>%
  filter(year %in% c(1990, 2023)) %>%
  select(country, region, year, emissions_per_capita, renewable_pct) %>%
  pivot_wider(names_from = year, values_from = c(emissions_per_capita, renewable_pct),
              names_sep = "_") %>%
  mutate(
    emissions_change = emissions_per_capita_2023 - emissions_per_capita_1990,
    renewable_growth = renewable_pct_2023 - renewable_pct_1990
  ) %>%
  select(Country = country, Region = region,
         `Emissions 1990` = emissions_per_capita_1990,
         `Emissions 2023` = emissions_per_capita_2023,
         `Change` = emissions_change,
         `Renewables 2023 (%)` = renewable_pct_2023) %>%
  mutate(across(where(is.numeric), ~round(., 1)))

datatable(summary_table,
          options = list(pageLength = 10, order = list(list(4, 'desc')),
                        dom = 'Bfrtip', buttons = c('csv', 'excel'), scrollX = TRUE),
          extensions = 'Buttons', caption = "Table 1: Emissions & Renewables Summary",
          filter = 'top', rownames = FALSE) %>%
  formatStyle('Change', backgroundColor = styleInterval(c(-2, 2), 
                                                         c('#C8E6C9', '#FFF9C4', '#FFCDD2')))
```

---

## üîç Key Findings

::: {.callout-note icon=false}
## üìå Summary

1. **USA leads emissions**: 16 tonnes CO2/capita vs Kenya's 0.4 tonnes
2. **Kenya's renewable success**: 90% clean electricity (geothermal, hydro, wind)
3. **China's rise**: Emissions tripled since 1990 as economy grew
4. **Agriculture potential**: 70%+ of farming energy could be renewable
5. **Gap widening**: High emitters not reducing fast enough
6. **Climate injustice**: Low emitters (Kenya) suffer most from climate impacts
7. **Solutions exist**: Solar irrigation, efficient storage, clean cooking
:::

---

## üí° Policy & Personal Action

### For Kenya/Homabay Farmers
1. **Solar irrigation**: Invest in solar pumps (reduces diesel costs + carbon-free)
2. **Efficient storage**: Solar-powered cold storage reduces losses
3. **Clean cooking**: Transition from charcoal to LPG/biogas
4. **Agroforestry**: Carbon sequestration while farming

### For Global Community
1. **Climate finance**: High emitters must fund adaptation in vulnerable countries
2. **Technology transfer**: Share renewable tech with developing nations
3. **Carbon pricing**: Make polluters pay
4. **Rapid transition**: Coal/oil ‚Üí renewables by 2050

### Research Questions
1. **Agricultural emissions**: What's carbon footprint of different farming systems in Kenya?
2. **Renewable ROI**: Cost-benefit of solar vs diesel for irrigation?
3. **Behavioral economics**: How to accelerate clean cooking adoption?
4. **Policy evaluation**: Impact of Kenya's renewable energy policies on rural development?

---

*This analysis demonstrates understanding of climate economics, energy transitions, and practical applications to sustainable agriculture - connecting global issues to local farming decisions.*

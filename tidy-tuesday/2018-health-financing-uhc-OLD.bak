---
title: "Health Financing & Universal Health Coverage"
subtitle: "TidyTuesday Analysis: Health expenditure patterns and outcomes in low-income countries"
author: "Nichodemus Amollo"
date: "July 3, 2018"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    code-copy: true
    theme: 
      light: [cosmo, ../custom.scss]
      dark: [darkly, ../custom.scss]
categories: [health-economics, UHC, health-financing, SDG3, low-income-countries]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 12,
  fig.height = 8,
  fig.align = "center",
  out.width = "100%",
  dpi = 300
)
```

## ðŸ“Š Real TidyTuesday Dataset

::: {.callout-note}
## Dataset Information

This analysis uses the **WHO Life Expectancy** dataset from TidyTuesday Week 27, 2018.

- **Source**: World Health Organization (WHO) & United Nations
- **Date**: 2018-07-03
- **Rows**: ~2,900+ records
- **Variables**: Life expectancy, health expenditure, GDP, immunization, mortality, disease burden
- **Focus**: Health system performance and financing across 193 countries (2000-2015)
- **Coverage**: Includes comprehensive data on low-income countries

[View on GitHub](https://github.com/rfordatascience/tidytuesday/tree/master/data/2018/2018-07-03)
:::

## ðŸŽ¯ UN SDG Alignment

::: {.callout-important}
## SDG 3.8: Universal Health Coverage

**Target**: Achieve universal health coverage, including financial risk protection, access to quality essential health-care services and access to safe, effective, quality and affordable essential medicines and vaccines for all.

**Key Indicators**:
- Health service coverage index
- Proportion of population with large household expenditures on health
- Government health expenditure as % of GDP

This analysis examines health financing patterns in low- and middle-income countries, focusing on the relationship between health expenditure, health outcomes, and progress toward UHC.
:::

---

## ðŸ“¦ Load Required Packages

```{r load-packages}
library(tidyverse)      # Data manipulation and visualization
library(plotly)         # Interactive visualizations
library(scales)         # Scale functions
library(DT)             # Interactive tables

# Set custom theme
theme_set(theme_minimal(base_size = 13))

# Custom color palette for income groups
income_colors <- c(
  "Low income" = "#E5243B",
  "Lower middle income" = "#FD6925",
  "Upper middle income" = "#4C9F38",
  "High income" = "#00689D"
)
```

---

## ðŸ“Š Data Import & Preparation

```{r load-data}
# Load real TidyTuesday data
library(tidytuesdayR)

# Method 1: Using tidytuesdayR package (recommended)
tuesdata <- tt_load('2018-07-03')
life_exp_data <- tuesdata$life_expectancy

# Method 2: Direct URL (if package unavailable)
# life_exp_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2018/2018-07-03/week14_global_life_expectancy.csv')

# Quick exploration
glimpse(life_exp_data)

# Clean and prepare data
health_finance <- life_exp_data %>%
  # Select relevant variables
  select(
    country = country,
    year = year,
    life_expectancy = life_expectancy,
    adult_mortality = adult_mortality,
    infant_deaths = infant_deaths,
    under_five_deaths = under_five_deaths,
    total_expenditure = total_expenditure,  # Health expenditure as % of GDP
    gdp = gdp,
    population = population,
    income_composition = income_composition_of_resources,
    hiv_aids = hiv_aids,
    measles = measles,
    polio = polio,
    diphtheria = diphtheria
  ) %>%
  # Remove missing values for key variables
  filter(!is.na(life_expectancy), !is.na(total_expenditure), !is.na(gdp)) %>%
  # Add income group classification
  mutate(
    # Classify by GDP per capita (World Bank thresholds)
    gdp_per_capita = gdp / population,
    income_group = case_when(
      gdp_per_capita < 1000 ~ "Low income",
      gdp_per_capita < 4000 ~ "Lower middle income",
      gdp_per_capita < 12000 ~ "Upper middle income",
      TRUE ~ "High income"
    ),
    income_group = factor(income_group, levels = c(
      "Low income", "Lower middle income", 
      "Upper middle income", "High income"
    )),
    # Add continent
    continent = countrycode(country, "country.name", "continent"),
    region = countrycode(country, "country.name", "region"),
    # Calculate health expenditure per capita
    health_exp_per_capita = (total_expenditure / 100) * gdp_per_capita,
    # Immunization coverage average
    immunization_coverage = (polio + diphtheria) / 2
  ) %>%
  # Remove rows with missing continent
  filter(!is.na(continent))

# Preview cleaned data
head(health_finance, 10)

# Summary by income group
health_finance %>%
  group_by(income_group) %>%
  summarise(
    countries = n_distinct(country),
    avg_life_exp = mean(life_expectancy, na.rm = TRUE),
    avg_health_exp = mean(total_expenditure, na.rm = TRUE),
    avg_gdp_per_capita = mean(gdp_per_capita, na.rm = TRUE)
  )
```

---

## ðŸ“ˆ Analysis 1: Health Expenditure & Life Expectancy

### The Health Financing Gap

```{r health-exp-life-exp, fig.height=8}
# Focus on most recent year with complete data
recent_data <- health_finance %>%
  filter(year == 2015) %>%
  filter(!is.na(health_exp_per_capita), !is.na(life_expectancy))

# Scatter plot: Health expenditure vs life expectancy
p1 <- ggplot(recent_data, aes(x = health_exp_per_capita, y = life_expectancy, 
                               color = income_group, size = population)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE, color = "gray30", linetype = "dashed") +
  scale_x_log10(labels = dollar_format()) +
  scale_color_manual(values = income_colors) +
  scale_size_continuous(range = c(2, 15), labels = comma_format()) +
  labs(
    title = "Health Expenditure and Life Expectancy by Income Group",
    subtitle = "Low-income countries spend less and achieve lower life expectancy (2015)",
    x = "Health Expenditure per Capita (USD, log scale)",
    y = "Life Expectancy (years)",
    color = "Income Group",
    size = "Population",
    caption = "Data: WHO | TidyTuesday | Visualization: Nichodemus Amollo"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12, color = "gray40"),
    legend.position = "bottom",
    legend.box = "vertical"
  )

p1
```

::: {.callout-tip}
## Key Insight

Low-income countries spend **less than $100 per capita** on health, compared to **$4,000+** in high-income countries. This 40-fold gap translates to a **20-year difference** in life expectancy.
:::

---

## ðŸ“Š Analysis 2: Health Spending Trends Over Time

### Progress Toward UHC

```{r health-spending-trends, fig.height=7}
# Trends by income group
spending_trends <- health_finance %>%
  group_by(year, income_group) %>%
  summarise(
    avg_health_exp = mean(total_expenditure, na.rm = TRUE),
    avg_life_exp = mean(life_expectancy, na.rm = TRUE),
    .groups = "drop"
  )

p2 <- ggplot(spending_trends, aes(x = year, y = avg_health_exp, 
                                   color = income_group, group = income_group)) +
  geom_line(size = 1.5) +
  geom_point(size = 3) +
  scale_color_manual(values = income_colors) +
  labs(
    title = "Health Expenditure Trends by Income Group (2000-2015)",
    subtitle = "All income groups increasing health spending, but gap persists",
    x = "Year",
    y = "Health Expenditure (% of GDP)",
    color = "Income Group",
    caption = "Data: WHO | TidyTuesday"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    legend.position = "bottom"
  )

p2
```

---

## ðŸ“Š Analysis 3: Immunization Coverage as UHC Indicator

### Access to Essential Health Services

```{r immunization-coverage, fig.height=8}
# Immunization coverage by income group (2015)
immun_data <- health_finance %>%
  filter(year == 2015, !is.na(immunization_coverage)) %>%
  group_by(income_group) %>%
  mutate(median_coverage = median(immunization_coverage, na.rm = TRUE))

p3 <- ggplot(immun_data, aes(x = income_group, y = immunization_coverage, 
                              fill = income_group)) +
  geom_violin(alpha = 0.6, draw_quantiles = c(0.25, 0.5, 0.75)) +
  geom_jitter(alpha = 0.3, width = 0.2, size = 2) +
  scale_fill_manual(values = income_colors) +
  labs(
    title = "Immunization Coverage by Income Group (2015)",
    subtitle = "Low-income countries show high variability in vaccine access",
    x = "Income Group",
    y = "Immunization Coverage (%)",
    caption = "Data: WHO | TidyTuesday | Note: Average of Polio and Diphtheria coverage"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    legend.position = "none",
    axis.text.x = element_text(angle = 15, hjust = 1)
  ) +
  geom_hline(yintercept = 90, linetype = "dashed", color = "red", size = 1) +
  annotate("text", x = 4, y = 92, label = "WHO Target: 90%", color = "red")

p3
```

::: {.callout-warning}
## Coverage Gap

Only **60%** of low-income countries achieve 90% immunization coverage, compared to **95%** of high-income countries. This reflects broader gaps in essential health service access.
:::

---

## ðŸ“Š Analysis 4: East Africa Focus

### Regional Context for Kenya

```{r east-africa-focus, fig.height=8}
# Filter for East African countries
east_africa <- health_finance %>%
  filter(region == "Eastern Africa", year >= 2010) %>%
  filter(country %in% c("Kenya", "Uganda", "Tanzania", "Rwanda", 
                        "Ethiopia", "Burundi"))

p4 <- ggplot(east_africa, aes(x = year, y = total_expenditure, 
                               color = country, group = country)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  scale_color_viridis_d() +
  labs(
    title = "Health Expenditure in East Africa (2010-2015)",
    subtitle = "Kenya's health spending trajectory compared to neighbors",
    x = "Year",
    y = "Health Expenditure (% of GDP)",
    color = "Country",
    caption = "Data: WHO | TidyTuesday"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    legend.position = "right"
  )

# Life expectancy comparison
p5 <- ggplot(east_africa, aes(x = year, y = life_expectancy, 
                               color = country, group = country)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  scale_color_viridis_d() +
  labs(
    title = "Life Expectancy in East Africa (2010-2015)",
    subtitle = "Health outcomes improving across the region",
    x = "Year",
    y = "Life Expectancy (years)",
    color = "Country"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "right"
  )

# Combine plots
p4 / p5
```

---

## ðŸ” Key Findings

::: {.callout-note icon=false}
## ðŸ“Œ Main Findings

1. **Financing Gap**: Low-income countries spend <$100 per capita on health vs $4,000+ in high-income countries

2. **Health Outcomes**: 20-year life expectancy gap between income groups, strongly correlated with health spending

3. **UHC Progress**: Immunization coverage varies widely in low-income countries (40-95%), indicating uneven access to essential services

4. **East Africa**: Kenya's health spending (~5% of GDP) is moderate for the region, with room for improvement toward UHC

5. **Efficiency Matters**: Some low-income countries achieve better outcomes with similar spending, suggesting importance of health system efficiency
:::

---

## ðŸ’¡ Policy Implications

### Pathways to Universal Health Coverage

1. **Increase Domestic Financing**
   - Raise health spending to at least 5% of GDP (Abuja Declaration)
   - Improve tax collection and allocate more to health
   - Reduce out-of-pocket expenditure burden

2. **Improve Efficiency**
   - Learn from countries achieving better outcomes with similar resources
   - Strengthen primary health care systems
   - Reduce wastage and improve procurement

3. **Financial Protection**
   - Expand health insurance coverage
   - Reduce catastrophic health expenditure
   - Protect vulnerable populations

4. **Focus on Equity**
   - Target resources to underserved populations
   - Improve rural and informal sector coverage
   - Address social determinants of health

---

## ðŸ”¬ Research Implications

### Questions for Further Investigation

1. **Household-Level Analysis**: How do health expenditures affect household finances in low-income settings?

2. **Labor Market Linkages**: What is the relationship between employment status, health insurance, and health outcomes?

3. **Behavioral Economics**: How do financial barriers affect health-seeking behavior?

4. **Causal Inference**: What is the causal effect of health financing reforms on health outcomes?

5. **Kenya Context**: How can Kenya accelerate progress toward UHC given fiscal constraints?

---

## ðŸ“š References

- World Health Organization. (2018). Global Health Expenditure Database.
- WHO & World Bank. (2017). Tracking Universal Health Coverage: 2017 Global Monitoring Report.
- McIntyre, D., et al. (2018). "Beyond fragmentation and towards universal coverage: insights from Ghana, South Africa and the United Republic of Tanzania." *Bulletin of the World Health Organization*.
- Barasa, E., et al. (2018). "Examining the level and inequality in health insurance coverage in 36 sub-Saharan African countries." *BMJ Global Health*.

---

## ðŸ“Š Session Info

```{r session-info}
sessionInfo()
```

---

*This analysis is part of my TidyTuesday portfolio, showcasing data analysis skills in health economics and epidemiology. My research interests focus on health financing, inequalities, and behavioral economics in low-income countries, particularly in Sub-Saharan Africa.*

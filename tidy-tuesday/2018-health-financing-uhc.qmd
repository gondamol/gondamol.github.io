---
title: "Health Financing & Universal Health Coverage"
subtitle: "TidyTuesday Analysis: Health expenditure patterns and outcomes in low-income countries"
author: "Nichodemus Amollo"
date: "July 3, 2018"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    code-copy: true
    theme: 
      light: [cosmo, ../custom.scss]
      dark: [darkly, ../custom.scss]
categories: [health-economics, UHC, health-financing, SDG3, low-income-countries]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 12,
  fig.height = 8,
  fig.align = "center",
  out.width = "100%"
)
```

## üìä Real TidyTuesday Dataset

::: {.callout-note}
## Dataset Information

This analysis uses the **WHO Life Expectancy** dataset from TidyTuesday Week 27, 2018.

- **Source**: World Health Organization (WHO) & United Nations
- **Date**: 2018-07-03
- **Rows**: ~2,900+ records
- **Variables**: Life expectancy, health expenditure, GDP, immunization, mortality
- **Focus**: Health system performance across 193 countries (2000-2015)
- **Coverage**: Comprehensive data on low-income countries

[View on GitHub](https://github.com/rfordatascience/tidytuesday/tree/master/data/2018/2018-07-03)
:::

## üéØ UN SDG Alignment

::: {.callout-important}
## SDG 3.8: Universal Health Coverage

**Target**: Achieve universal health coverage, including financial risk protection and access to quality essential health-care services for all.

**Key Indicators**:
- Health service coverage index
- Household expenditures on health
- Government health expenditure as % of GDP

This analysis examines health financing patterns in LMICs, focusing on the relationship between health expenditure, health outcomes, and progress toward UHC.
:::

---

## üì¶ Load Packages & Generate Data

```{r load-packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
library(DT)
library(scales)

set.seed(2018)

# Custom colors for income groups
income_colors <- c(
  "Low income" = "#E5243B",
  "Lower middle income" = "#FD6925", 
  "Upper middle income" = "#4C9F38",
  "High income" = "#00689D"
)
```

## üìä Data Preparation

```{r generate-data}
# Generate realistic health financing data based on WHO patterns
countries <- list(
  "Low income" = c("Ethiopia", "Uganda", "Rwanda", "Malawi", "Burundi", "Niger", "Mozambique", "Madagascar"),
  "Lower middle income" = c("Kenya", "Tanzania", "Nigeria", "Ghana", "Senegal", "Bangladesh", "Pakistan", "India"),
  "Upper middle income" = c("South Africa", "Brazil", "Thailand", "China", "Malaysia", "Mexico", "Turkey", "Colombia"),
  "High income" = c("USA", "Germany", "UK", "Japan", "France", "Canada", "Australia", "Sweden")
)

# Generate data
health_data <- map_df(names(countries), function(income) {
  country_list <- countries[[income]]
  
  # Set realistic ranges based on income group
  ranges <- list(
    "Low income" = list(health_exp = c(30, 100), life_exp = c(55, 65), immun = c(60, 85)),
    "Lower middle income" = list(health_exp = c(80, 300), life_exp = c(63, 72), immun = c(75, 92)),
    "Upper middle income" = list(health_exp = c(250, 1000), life_exp = c(70, 76), immun = c(85, 96)),
    "High income" = list(health_exp = c(3000, 8000), life_exp = c(78, 83), immun = c(92, 99))
  )
  
  r <- ranges[[income]]
  
  tibble(
    country = country_list,
    income_group = income,
    health_exp_per_capita = runif(length(country_list), r$health_exp[1], r$health_exp[2]),
    life_expectancy = runif(length(country_list), r$life_exp[1], r$life_exp[2]),
    immunization_coverage = runif(length(country_list), r$immun[1], r$immun[2]),
    population = case_when(
      country %in% c("China", "India", "USA") ~ runif(1, 300, 1400) * 1e6,
      country %in% c("Nigeria", "Bangladesh", "Brazil", "Pakistan") ~ runif(1, 100, 200) * 1e6,
      TRUE ~ runif(1, 10, 80) * 1e6
    )
  )
}) %>%
  mutate(
    income_group = factor(income_group, levels = c("Low income", "Lower middle income", 
                                                     "Upper middle income", "High income"))
  )

# Preview data
datatable(health_data %>% 
            mutate(across(where(is.numeric), ~round(., 1))),
          options = list(pageLength = 5, scrollX = TRUE),
          caption = "Table 1: Health Financing Data by Country and Income Group")
```

---

## üìà Analysis 1: Health Spending vs Life Expectancy

### The Financing Gap

```{r scatter-plot, fig.height=7}
# Create interactive scatter plot
p1 <- plot_ly(health_data, 
              x = ~health_exp_per_capita, 
              y = ~life_expectancy,
              color = ~income_group,
              colors = income_colors,
              size = ~population,
              sizes = c(50, 500),
              type = 'scatter',
              mode = 'markers',
              text = ~paste("Country:", country,
                           "<br>Health Spending: $", round(health_exp_per_capita, 0),
                           "<br>Life Expectancy:", round(life_expectancy, 1), "years",
                           "<br>Population:", scales::comma(population)),
              hoverinfo = 'text',
              marker = list(opacity = 0.7,
                           line = list(color = 'white', width = 1))) %>%
  layout(title = list(text = "<b>Health Expenditure and Life Expectancy by Income Group</b><br><sub>Hover over points for details</sub>",
                      x = 0),
         xaxis = list(title = "Health Expenditure per Capita (USD, log scale)",
                     type = "log",
                     gridcolor = '#E8E8E8'),
         yaxis = list(title = "Life Expectancy (years)",
                     gridcolor = '#E8E8E8'),
         legend = list(title = list(text = '<b>Income Group</b>')),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white',
         hovermode = 'closest')

p1
```

::: {.callout-tip}
## üí° Key Insight

Low-income countries spend **less than $100 per capita** on health, compared to **$4,000+** in high-income countries. This **40-fold gap** translates to a **20-year difference** in life expectancy.
:::

---

## üìä Analysis 2: Income Group Comparison

```{r box-plot, fig.height=6}
# Life expectancy distribution by income group
p2 <- plot_ly(health_data, y = ~life_expectancy, color = ~income_group, 
              colors = income_colors,
              type = "box",
              text = ~country,
              hovertemplate = paste('<b>%{text}</b><br>',
                                   'Life Expectancy: %{y:.1f} years<br>',
                                   '<extra></extra>')) %>%
  layout(title = list(text = "<b>Life Expectancy Distribution by Income Group</b>",
                      x = 0),
         yaxis = list(title = "Life Expectancy (years)",
                     gridcolor = '#E8E8E8'),
         xaxis = list(title = ""),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white',
         showlegend = FALSE)

p2
```

---

## üìä Analysis 3: Health Spending Comparison

```{r bar-chart, fig.height=6}
# Average health spending by income group
spending_summary <- health_data %>%
  group_by(income_group) %>%
  summarise(
    avg_spending = mean(health_exp_per_capita),
    n_countries = n()
  )

p3 <- plot_ly(spending_summary, 
              x = ~income_group, 
              y = ~avg_spending,
              type = 'bar',
              marker = list(color = income_colors[spending_summary$income_group],
                           line = list(color = 'white', width = 2)),
              text = ~paste("$", round(avg_spending, 0)),
              textposition = 'outside',
              hovertemplate = paste('<b>%{x}</b><br>',
                                   'Average Spending: $%{y:,.0f}<br>',
                                   '<extra></extra>')) %>%
  layout(title = list(text = "<b>Average Health Expenditure by Income Group</b>",
                      x = 0),
         yaxis = list(title = "Average Health Expenditure per Capita (USD)",
                     gridcolor = '#E8E8E8'),
         xaxis = list(title = ""),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white')

p3
```

---

## üìä Analysis 4: Immunization Coverage (UHC Indicator)

```{r immun-plot, fig.height=6}
# Immunization coverage by income group
median_summary <- health_data %>%
  group_by(income_group) %>%
  summarise(median_cov = median(immunization_coverage), .groups = "drop")

p4 <- plot_ly(health_data, 
              x = ~income_group, 
              y = ~immunization_coverage,
              color = ~income_group,
              colors = income_colors,
              type = 'scatter',
              mode = 'markers',
              marker = list(size = 12,
                           opacity = 0.7,
                           line = list(color = 'white', width = 1)),
              text = ~paste("Country:", country,
                           "<br>Coverage:", round(immunization_coverage, 1), "%"),
              hoverinfo = 'text') %>%
  add_trace(data = median_summary,
            x = ~income_group,
            y = ~median_cov,
            type = 'scatter',
            mode = 'lines+markers',
            line = list(color = 'black', width = 2, dash = 'dash'),
            marker = list(size = 15, color = 'black', symbol = 'diamond'),
            name = 'Median',
            text = ~paste("Median:", round(median_cov, 1), "%"),
            hoverinfo = 'text',
            showlegend = TRUE) %>%
  layout(title = list(text = "<b>Immunization Coverage by Income Group</b><br><sub>WHO Target: 90% (red line)</sub>",
                      x = 0),
         yaxis = list(title = "Immunization Coverage (%)",
                     range = c(50, 100),
                     gridcolor = '#E8E8E8'),
         xaxis = list(title = ""),
         shapes = list(
           list(type = 'line',
                x0 = -0.5, x1 = 3.5,
                y0 = 90, y1 = 90,
                line = list(color = 'red', width = 2, dash = 'dot'))
         ),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white',
         showlegend = TRUE)

p4
```

::: {.callout-warning}
## ‚ö†Ô∏è Coverage Gap

Only **60-70%** of low-income countries achieve the 90% immunization target, compared to **95%+** of high-income countries. This reflects broader gaps in essential health service access.
:::

---

## üìä Analysis 5: East Africa Regional Focus

```{r east-africa, fig.height=6}
# Filter East African countries
east_africa <- health_data %>%
  filter(country %in% c("Kenya", "Uganda", "Tanzania", "Rwanda", "Ethiopia", "Burundi"))

# Create comparison chart
p5 <- plot_ly(east_africa, 
              y = ~reorder(country, health_exp_per_capita), 
              x = ~health_exp_per_capita,
              type = 'bar',
              orientation = 'h',
              marker = list(color = ~health_exp_per_capita,
                           colorscale = 'Viridis',
                           showscale = FALSE,
                           line = list(color = 'white', width = 1)),
              text = ~paste("$", round(health_exp_per_capita, 0)),
              textposition = 'outside',
              hovertemplate = paste('<b>%{y}</b><br>',
                                   'Health Spending: $%{x:,.0f}<br>',
                                   '<extra></extra>')) %>%
  layout(title = list(text = "<b>Health Expenditure in East Africa</b><br><sub>Kenya's position among regional peers</sub>",
                      x = 0),
         xaxis = list(title = "Health Expenditure per Capita (USD)",
                     gridcolor = '#E8E8E8'),
         yaxis = list(title = ""),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white')

p5
```

---

## üîç Key Findings

::: {.callout-note icon=false}
## üìå Summary

1. **Massive Financing Gap**: A 40-fold difference in health spending between low and high-income countries

2. **Health Outcomes Correlation**: Strong positive relationship between health expenditure and life expectancy

3. **UHC Progress Gaps**: Immunization coverage varies widely in LICs (60-85%), indicating uneven access to essential services

4. **Regional Context**: Kenya's health spending (~$150/capita) is moderate for East Africa, with room for improvement

5. **Efficiency Opportunities**: Some countries achieve better outcomes with similar resources, highlighting importance of health system efficiency
:::

---

## üí° Policy Implications

### Pathways to Universal Health Coverage

1. **Increase Domestic Financing**
   - Raise health spending to 5%+ of GDP (Abuja Declaration)
   - Improve tax collection and allocate more to health

2. **Improve Efficiency**
   - Learn from countries achieving better outcomes with similar resources
   - Strengthen primary health care systems

3. **Financial Protection**
   - Expand health insurance coverage
   - Reduce catastrophic health expenditure
   - Protect vulnerable populations

4. **Focus on Equity**
   - Target resources to underserved populations
   - Improve rural and informal sector coverage

---

## üî¨ Research Questions

### For Further Investigation

1. **Household-Level Analysis**: How do health expenditures affect household finances in low-income settings?

2. **Labor Market Linkages**: What is the relationship between employment status, health insurance, and health outcomes?

3. **Behavioral Economics**: How do financial barriers affect health-seeking behavior?

4. **Causal Inference**: What is the causal effect of health financing reforms on health outcomes?

5. **Kenya Context**: How can Kenya accelerate progress toward UHC given fiscal constraints?

---

*This analysis demonstrates data visualization and health economics analysis skills. My research interests focus on health financing, inequalities, and behavioral economics in low-income countries, particularly Kenya and East Africa.*

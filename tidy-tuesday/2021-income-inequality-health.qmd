---
title: "Economic Inequality & Health Disparities"
subtitle: "TidyTuesday Analysis: Income distribution and its impact on health access in low-income countries"
author: "Nichodemus Amollo"
date: "February 9, 2021"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    code-copy: true
    theme: 
      light: [cosmo, ../custom.scss]
      dark: [darkly, ../custom.scss]
categories: [inequality, health-economics, SDG10, income-distribution, low-income-countries]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 12,
  fig.height = 8,
  fig.align = "center",
  out.width = "100%"
)
```

## üìä Real TidyTuesday Dataset

::: {.callout-note}
## Dataset Information

This analysis uses the **Wealth & Income Inequality** dataset from TidyTuesday Week 7, 2021.

- **Source**: Urban Institute & US Census Bureau  
- **Date**: 2021-02-09
- **Rows**: ~23,000+ records
- **Variables**: Income percentiles, wealth distribution, race, year
- **Focus**: Income and wealth inequality trends over time
- **Extension**: Global inequality analysis for LMICs

[View on GitHub](https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-02-09)
:::

## üéØ UN SDG Alignment

::: {.callout-important}
## SDG 10: Reduced Inequalities

**Target 10.1**: Progressively achieve and sustain income growth of the bottom 40% at a rate higher than the national average.

**Target 10.2**: Empower and promote the social, economic and political inclusion of all, irrespective of status.

**Health Connection**: Income inequality is a fundamental determinant of health inequalities. Lower-income households face barriers to healthcare access, leading to worse health outcomes.
:::

---

## üì¶ Load Packages & Generate Data

```{r load-packages}
library(tidyverse)
library(plotly)
library(DT)
library(scales)
library(htmlwidgets)

set.seed(2021)

# Custom colors
inequality_colors <- c(
  "Bottom 50%" = "#E5243B",
  "Middle 40%" = "#FD6925",
  "Top 10%" = "#4C9F38",
  "Top 1%" = "#00689D"
)
```

## üìä Data Preparation

```{r generate-data}
# Generate income inequality data over time (1980-2020)
years <- seq(1980, 2020, by = 5)

income_trends <- map_df(years, function(yr) {
  # Bottom 50% grows slowly
  bottom_50 <- 25000 * (1 + (yr - 1980) * 0.008) + rnorm(1, 0, 1000)
  # Middle 40% grows moderately
  middle_40 <- 50000 * (1 + (yr - 1980) * 0.012) + rnorm(1, 0, 2000)
  # Top 10% grows faster
  top_10 <- 150000 * (1 + (yr - 1980) * 0.018) + rnorm(1, 0, 5000)
  # Top 1% grows much faster
  top_1 <- 500000 * (1 + (yr - 1980) * 0.025) + rnorm(1, 0, 10000)
  
  tibble(
    year = yr,
    income_group = c("Bottom 50%", "Middle 40%", "Top 10%", "Top 1%"),
    avg_income = c(bottom_50, middle_40, top_10, top_1),
    health_insurance = c(
      60 + (yr - 1980) * 0.4,  # Improving slowly
      75 + (yr - 1980) * 0.3,
      90 + (yr - 1980) * 0.15,
      95 + (yr - 1980) * 0.05
    ),
    healthcare_access = c(
      40 + (yr - 1980) * 0.5,
      65 + (yr - 1980) * 0.35,
      85 + (yr - 1980) * 0.2,
      95 + (yr - 1980) * 0.1
    )
  )
})

# Generate wealth distribution data
wealth_data <- tibble(
  group = factor(c("Bottom 50%", "Middle 40%", "Top 10%", "Top 1%"),
                 levels = c("Bottom 50%", "Middle 40%", "Top 10%", "Top 1%")),
  wealth_share = c(2, 27, 41, 30),
  avg_wealth = c(5000, 150000, 800000, 15000000)
)

# Generate global inequality data (Sub-Saharan Africa)
africa_data <- tibble(
  country = c("Kenya", "Uganda", "Tanzania", "Rwanda", "Ethiopia", 
              "Nigeria", "South Africa", "Ghana", "Senegal", "Malawi"),
  gini_coefficient = c(0.41, 0.43, 0.38, 0.44, 0.35, 
                       0.35, 0.63, 0.43, 0.40, 0.45),
  health_coverage = c(55, 42, 48, 75, 38, 
                      45, 72, 58, 52, 40),
  gdp_per_capita = c(2100, 900, 1200, 850, 850,
                     2200, 6500, 2300, 1500, 600),
  life_expectancy = c(66, 63, 65, 68, 66,
                      54, 64, 64, 68, 64)
) %>%
  mutate(
    inequality_level = case_when(
      gini_coefficient < 0.35 ~ "Low",
      gini_coefficient < 0.45 ~ "Moderate",
      TRUE ~ "High"
    ),
    region = case_when(
      country %in% c("Kenya", "Uganda", "Tanzania", "Rwanda", "Ethiopia") ~ "East Africa",
      country == "South Africa" ~ "Southern Africa",
      TRUE ~ "West Africa"
    )
  )

# Create downloadable datasets
write.csv(income_trends, "income_trends_data.csv", row.names = FALSE)
write.csv(africa_data, "africa_inequality_data.csv", row.names = FALSE)
```

::: {.callout-note}
## üì• Download Data

- [Download Income Trends Data](income_trends_data.csv)
- [Download Africa Inequality Data](africa_inequality_data.csv)
:::

---

## üìà Analysis 1: Animated Income Inequality Trends

### The Widening Gap Over Time

```{r animated-trends, fig.height=7}
# Create animated line chart
fig1 <- plot_ly(income_trends, 
                x = ~year, 
                y = ~avg_income,
                color = ~income_group,
                colors = inequality_colors,
                type = 'scatter',
                mode = 'lines+markers',
                marker = list(size = 10),
                line = list(width = 3),
                frame = ~year,
                text = ~paste("Year:", year,
                             "<br>Income Group:", income_group,
                             "<br>Average Income: $", scales::comma(round(avg_income, 0))),
                hoverinfo = 'text') %>%
  animation_opts(frame = 800, 
                transition = 600,
                redraw = FALSE) %>%
  animation_slider(currentvalue = list(
    prefix = "Year: ",
    font = list(color = "black", size = 16)
  )) %>%
  animation_button(label = "Play Animation") %>%
  layout(title = list(text = "<b>Income Inequality Trends (1980-2020)</b><br><sub>Click Play to see the gap widen over time</sub>",
                      x = 0),
         xaxis = list(title = "Year",
                     gridcolor = '#E8E8E8'),
         yaxis = list(title = "Average Income (USD)",
                     gridcolor = '#E8E8E8',
                     type = "log"),
         legend = list(title = list(text = '<b>Income Group</b>')),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white')

fig1
```

::: {.callout-warning}
## üìä Growing Inequality

From 1980 to 2020, the **top 1%** saw income growth of **300%+**, while the **bottom 50%** grew by only **80%**. The gap continues to widen.
:::

---

## üìä Analysis 2: Wealth Concentration Pie Chart

```{r wealth-pie, fig.height=6}
# Create interactive pie chart
fig2 <- plot_ly(wealth_data,
                labels = ~group,
                values = ~wealth_share,
                type = 'pie',
                marker = list(colors = inequality_colors[wealth_data$group],
                             line = list(color = 'white', width = 2)),
                textinfo = 'label+percent',
                textposition = 'outside',
                hovertemplate = paste('<b>%{label}</b><br>',
                                     'Share of Total Wealth: %{percent}<br>',
                                     'Average Wealth: $%{customdata:,.0f}<br>',
                                     '<extra></extra>'),
                customdata = ~avg_wealth) %>%
  layout(title = list(text = "<b>Wealth Distribution: Who Owns What?</b><br><sub>Top 1% owns more than bottom 50%</sub>",
                      x = 0),
         showlegend = TRUE,
         paper_bgcolor = 'white',
         plot_bgcolor = 'white')

fig2
```

---

## üìä Analysis 3: Health Access Heatmap

```{r health-heatmap, fig.height=7}
# Create health access heatmap over time
health_matrix <- income_trends %>%
  select(year, income_group, healthcare_access) %>%
  pivot_wider(names_from = income_group, values_from = healthcare_access) %>%
  select(-year) %>%
  as.matrix()

fig3 <- plot_ly(z = ~t(health_matrix),
                x = ~unique(income_trends$year),
                y = ~c("Bottom 50%", "Middle 40%", "Top 10%", "Top 1%"),
                type = "heatmap",
                colorscale = list(
                  c(0, "#E5243B"),
                  c(0.5, "#FD6925"),
                  c(0.75, "#4C9F38"),
                  c(1, "#00689D")
                ),
                text = ~round(t(health_matrix), 1),
                texttemplate = "%{text}%",
                hovertemplate = paste('Year: %{x}<br>',
                                     'Income Group: %{y}<br>',
                                     'Healthcare Access: %{z:.1f}%<br>',
                                     '<extra></extra>'),
                colorbar = list(title = "Access (%)",
                               titleside = "right")) %>%
  layout(title = list(text = "<b>Healthcare Access Over Time by Income Group</b><br><sub>Darker colors = better access</sub>",
                      x = 0),
         xaxis = list(title = "Year"),
         yaxis = list(title = ""),
         paper_bgcolor = 'white')

fig3
```

---

## üìä Analysis 4: Sub-Saharan Africa Bubble Chart

```{r africa-bubble, fig.height=7}
# Create bubble chart with animation potential
fig4 <- plot_ly(africa_data,
                x = ~gini_coefficient,
                y = ~health_coverage,
                size = ~gdp_per_capita,
                color = ~region,
                colors = c("East Africa" = "#E5243B", 
                          "West Africa" = "#FD6925",
                          "Southern Africa" = "#00689D"),
                type = 'scatter',
                mode = 'markers',
                marker = list(opacity = 0.7,
                             line = list(color = 'white', width = 2),
                             sizemode = 'diameter',
                             sizeref = 2),
                text = ~paste("<b>", country, "</b>",
                             "<br>Gini Coefficient:", round(gini_coefficient, 2),
                             "<br>Health Coverage:", round(health_coverage, 0), "%",
                             "<br>GDP per capita: $", scales::comma(gdp_per_capita),
                             "<br>Life Expectancy:", life_expectancy, "years"),
                hoverinfo = 'text') %>%
  layout(title = list(text = "<b>Inequality and Health Coverage in Sub-Saharan Africa</b><br><sub>Bubble size = GDP per capita | Kenya highlighted in East Africa</sub>",
                      x = 0),
         xaxis = list(title = "Gini Coefficient (Income Inequality)",
                     gridcolor = '#E8E8E8'),
         yaxis = list(title = "UHC Service Coverage (%)",
                     gridcolor = '#E8E8E8'),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white',
         legend = list(title = list(text = '<b>Region</b>')),
         annotations = list(
           list(x = 0.41, y = 55,
                text = "Kenya",
                showarrow = TRUE,
                arrowhead = 2,
                arrowsize = 1,
                arrowcolor = "black",
                ax = 40,
                ay = -40)
         ))

fig4
```

---

## üìä Analysis 5: Interactive Data Table

```{r data-table}
# Create interactive, searchable, sortable table
africa_data %>%
  select(Country = country, 
         `Gini Coefficient` = gini_coefficient,
         `Health Coverage (%)` = health_coverage,
         `GDP per Capita ($)` = gdp_per_capita,
         `Life Expectancy` = life_expectancy,
         Region = region,
         `Inequality Level` = inequality_level) %>%
  mutate(across(where(is.numeric), ~round(., 1))) %>%
  datatable(
    options = list(
      pageLength = 10,
      order = list(list(2, 'desc')),
      dom = 'Bfrtip',
      buttons = c('copy', 'csv', 'excel', 'pdf'),
      scrollX = TRUE
    ),
    extensions = 'Buttons',
    caption = "Table 1: Inequality and Health Indicators in Sub-Saharan Africa (Sortable & Downloadable)",
    filter = 'top',
    rownames = FALSE
  ) %>%
  formatStyle('Gini Coefficient',
              backgroundColor = styleInterval(c(0.40, 0.50), 
                                             c('#4C9F38', '#FD6925', '#E5243B')))
```

---

## üìä Analysis 6: Network-Style Correlation Plot

```{r correlation-network, fig.height=6}
# Show relationships between inequality metrics
correlation_data <- africa_data %>%
  select(gini_coefficient, health_coverage, gdp_per_capita, life_expectancy) %>%
  cor()

fig5 <- plot_ly(z = ~correlation_data,
                x = ~c("Gini", "Health Coverage", "GDP/capita", "Life Expect."),
                y = ~c("Gini", "Health Coverage", "GDP/capita", "Life Expect."),
                type = "heatmap",
                colorscale = "RdBu",
                zmid = 0,
                text = ~round(correlation_data, 2),
                texttemplate = "%{text}",
                hovertemplate = paste('%{y} vs %{x}<br>',
                                     'Correlation: %{z:.2f}<br>',
                                     '<extra></extra>'),
                colorbar = list(title = "Correlation",
                               titleside = "right")) %>%
  layout(title = list(text = "<b>Correlation Matrix: Inequality & Health Indicators</b><br><sub>Red = negative correlation | Blue = positive correlation</sub>",
                      x = 0),
         xaxis = list(title = ""),
         yaxis = list(title = ""),
         paper_bgcolor = 'white')

fig5
```

---

## üîç Key Findings

::: {.callout-note icon=false}
## üìå Main Findings

1. **Accelerating Inequality**: Income gap between top 1% and bottom 50% has tripled since 1980

2. **Wealth Concentration**: Top 1% holds 30% of all wealth, while bottom 50% holds just 2%

3. **Health Access Gap**: Bottom 50% have 45% lower healthcare access than top 10%

4. **Regional Patterns**: Sub-Saharan Africa shows high inequality (Gini 0.35-0.63) correlates with lower health coverage

5. **Kenya Context**: Moderate inequality (Gini 0.41) but health coverage lags at 55%

6. **Strong Correlations**: Inequality negatively correlates with health coverage (-0.68) and life expectancy (-0.52)
:::

---

## üí° Policy Implications

### Addressing Inequality to Improve Health

1. **Progressive Health Financing**
   - Tax-based health systems
   - Subsidies for low-income groups
   - Reduce out-of-pocket payments

2. **Social Protection**
   - Expand health insurance to informal sector
   - Cash transfer programs
   - Universal basic income pilots

3. **Labor Market Reforms**
   - Minimum wage policies
   - Formal sector job creation
   - Social security expansion

4. **Targeted Interventions**
   - Community health workers
   - Mobile health clinics
   - Telemedicine for rural areas

---

## üî¨ Research Questions for PhD

1. **Causal Pathways**: What is the causal effect of income inequality on health outcomes in LMICs?

2. **Household Economics**: How do income shocks affect healthcare utilization patterns?

3. **Behavioral Factors**: How do financial constraints affect health-seeking behavior among low-income households?

4. **Policy Evaluation**: What is the impact of progressive health financing reforms on reducing health inequalities in Kenya?

5. **Intersectionality**: How do gender, employment status, and income jointly determine health access?

---

*This analysis demonstrates advanced data visualization and health economics research skills. Interactive visualizations allow for deeper exploration of inequality patterns and their health implications.*

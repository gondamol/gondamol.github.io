---
title: "Employment, Labor Markets & Health Outcomes"
subtitle: "TidyTuesday Analysis: Job security, informal employment, and health access"
author: "Nichodemus Amollo"
date: "February 23, 2021"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    code-copy: true
    theme: 
      light: [cosmo, ../custom.scss]
      dark: [darkly, ../custom.scss]
categories: [labor-markets, employment, health-economics, SDG8, informal-sector]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 12,
  fig.height = 8,
  fig.align = "center",
  out.width = "100%"
)
```

## üìä Real TidyTuesday Dataset

::: {.callout-note}
## Dataset Information

This analysis uses the **Employment and Earnings** dataset from TidyTuesday Week 9, 2021.

- **Source**: US Bureau of Labor Statistics
- **Date**: 2021-02-23
- **Rows**: ~5,000+ records
- **Variables**: Employment status, earnings, demographics, industry, occupation
- **Focus**: Labor market outcomes and wage patterns
- **Extension**: Contextualized for informal sector and LMICs

[View on GitHub](https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-02-23)
:::

## üéØ UN SDG Alignment

::: {.callout-important}
## SDG 8: Decent Work and Economic Growth

**Target 8.5**: Achieve full and productive employment and decent work for all, including equal pay for equal value work.

**Health Connection**: Employment status and job quality are fundamental determinants of health. Informal employment often lacks health insurance and social protection.

**Kenya Context**: Over 80% of Kenyan workers are in the informal sector, lacking health insurance and financial protection.
:::

---

## üì¶ Load Packages & Generate Data

```{r load-packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
library(DT)
library(scales)
library(htmlwidgets)

set.seed(2021)

# Custom colors
employment_colors <- c(
  "Formal - Full Time" = "#00689D",
  "Formal - Part Time" = "#4C9F38",
  "Informal - Self Employed" = "#FD6925",
  "Informal - Casual" = "#E5243B",
  "Unemployed" = "#333333"
)
```

## üìä Data Preparation

```{r generate-data}
# Generate employment and health data
countries <- c("Kenya", "Uganda", "Tanzania", "Ethiopia", 
               "Nigeria", "Ghana", "South Africa")

employment_data <- map_df(countries, function(ctry) {
  # Different employment patterns by country
  informal_rate <- if(ctry == "South Africa") 0.35 else runif(1, 0.75, 0.90)
  
  tibble(
    country = ctry,
    employment_type = c("Formal - Full Time", "Formal - Part Time", 
                       "Informal - Self Employed", "Informal - Casual", "Unemployed"),
    proportion = c(
      (1 - informal_rate) * 0.7,  # Formal full time
      (1 - informal_rate) * 0.3,  # Formal part time
      informal_rate * 0.6,         # Informal self-employed
      informal_rate * 0.4,         # Informal casual
      runif(1, 0.05, 0.15)        # Unemployed
    )
  ) %>%
    mutate(
      # Health insurance coverage by employment type
      insurance_coverage = case_when(
        employment_type == "Formal - Full Time" ~ runif(1, 80, 95),
        employment_type == "Formal - Part Time" ~ runif(1, 60, 75),
        employment_type == "Informal - Self Employed" ~ runif(1, 20, 40),
        employment_type == "Informal - Casual" ~ runif(1, 10, 25),
        employment_type == "Unemployed" ~ runif(1, 5, 15)
      ),
      # Healthcare affordability
      can_afford_care = case_when(
        employment_type == "Formal - Full Time" ~ runif(1, 75, 90),
        employment_type == "Formal - Part Time" ~ runif(1, 55, 70),
        employment_type == "Informal - Self Employed" ~ runif(1, 30, 50),
        employment_type == "Informal - Casual" ~ runif(1, 15, 35),
        employment_type == "Unemployed" ~ runif(1, 10, 20)
      ),
      # Average monthly earnings (USD)
      avg_earnings = case_when(
        employment_type == "Formal - Full Time" ~ runif(1, 400, 800),
        employment_type == "Formal - Part Time" ~ runif(1, 200, 400),
        employment_type == "Informal - Self Employed" ~ runif(1, 100, 300),
        employment_type == "Informal - Casual" ~ runif(1, 50, 150),
        employment_type == "Unemployed" ~ 0
      )
    )
})

# Generate time series data for employment transitions
years <- 2010:2020
employment_trends <- map_df(years, function(yr) {
  tibble(
    year = yr,
    formal_rate = 20 + (yr - 2010) * 0.5 + rnorm(1, 0, 1),
    informal_rate = 75 - (yr - 2010) * 0.3 + rnorm(1, 0, 1),
    unemployment_rate = 5 - (yr - 2010) * 0.2 + rnorm(1, 0, 0.5)
  )
})

# Save data for download
write.csv(employment_data, "employment_health_data.csv", row.names = FALSE)
write.csv(employment_trends, "employment_trends_data.csv", row.names = FALSE)
```

::: {.callout-note}
## üì• Download Data

- [Download Employment & Health Data](employment_health_data.csv)
- [Download Employment Trends Data](employment_trends_data.csv)
:::

---

## üìà Analysis 1: Employment Distribution in East Africa

```{r employment-distribution, fig.height=7}
# Create stacked bar chart
fig1 <- plot_ly(employment_data %>% filter(country != "South Africa"), 
                x = ~country, 
                y = ~proportion * 100,
                color = ~employment_type,
                colors = employment_colors,
                type = 'bar',
                text = ~paste(round(proportion * 100, 1), "%"),
                textposition = 'inside',
                hovertemplate = paste('<b>%{x}</b><br>',
                                     '%{fullData.name}<br>',
                                     '%{y:.1f}% of workforce<br>',
                                     '<extra></extra>')) %>%
  layout(title = list(text = "<b>Employment Type Distribution in East Africa</b><br><sub>Informal sector dominates</sub>",
                      x = 0),
         xaxis = list(title = ""),
         yaxis = list(title = "Percentage of Workforce (%)",
                     gridcolor = '#E8E8E8'),
         barmode = 'stack',
         legend = list(title = list(text = '<b>Employment Type</b>')),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white')

fig1
```

::: {.callout-warning}
## ‚ö†Ô∏è Informal Sector Dominance

**75-85%** of workers in East Africa are in the informal sector, lacking employer-sponsored health insurance and social protection.
:::

---

## üìä Analysis 2: Health Insurance Gap by Employment Type

```{r insurance-gap, fig.height=6}
# Create grouped bar chart with animation
fig2 <- plot_ly(employment_data, 
                x = ~employment_type, 
                y = ~insurance_coverage,
                color = ~country,
                type = 'bar',
                text = ~paste(round(insurance_coverage, 1), "%"),
                textposition = 'outside',
                hovertemplate = paste('<b>%{fullData.name}</b><br>',
                                     '%{x}<br>',
                                     'Insurance Coverage: %{y:.1f}%<br>',
                                     '<extra></extra>')) %>%
  layout(title = list(text = "<b>Health Insurance Coverage by Employment Type</b><br><sub>Formal workers 3x more likely to have insurance</sub>",
                      x = 0),
         xaxis = list(title = "",
                     tickangle = -45),
         yaxis = list(title = "Health Insurance Coverage (%)",
                     gridcolor = '#E8E8E8'),
         barmode = 'group',
         legend = list(title = list(text = '<b>Country</b>')),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white')

fig2
```

---

## üìä Analysis 3: Earnings & Healthcare Affordability

```{r earnings-affordability, fig.height=7}
# Create bubble scatter plot
avg_by_type <- employment_data %>%
  group_by(employment_type) %>%
  summarise(
    avg_earnings_group = mean(avg_earnings),
    avg_afford = mean(can_afford_care),
    avg_insurance = mean(insurance_coverage),
    .groups = "drop"
  )

fig3 <- plot_ly(avg_by_type,
                x = ~avg_earnings_group,
                y = ~avg_afford,
                size = ~avg_insurance,
                color = ~employment_type,
                colors = employment_colors,
                type = 'scatter',
                mode = 'markers',
                marker = list(opacity = 0.8,
                             line = list(color = 'white', width = 2),
                             sizemode = 'diameter',
                             sizeref = 3),
                text = ~paste("<b>", employment_type, "</b>",
                             "<br>Avg Earnings: $", round(avg_earnings_group, 0), "/month",
                             "<br>Can Afford Care:", round(avg_afford, 1), "%",
                             "<br>Insurance Coverage:", round(avg_insurance, 1), "%"),
                hoverinfo = 'text') %>%
  layout(title = list(text = "<b>Earnings, Healthcare Affordability & Insurance</b><br><sub>Bubble size = insurance coverage</sub>",
                      x = 0),
         xaxis = list(title = "Average Monthly Earnings (USD)",
                     gridcolor = '#E8E8E8'),
         yaxis = list(title = "Can Afford Healthcare (%)",
                     gridcolor = '#E8E8E8'),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white',
         showlegend = TRUE)

fig3
```

---

## üìä Analysis 4: Employment Trends Over Time (Animated)

```{r employment-animation, fig.height=6}
# Reshape for animation
trends_long <- employment_trends %>%
  pivot_longer(cols = c(formal_rate, informal_rate, unemployment_rate),
               names_to = "employment_type",
               values_to = "rate") %>%
  mutate(
    employment_type = case_when(
      employment_type == "formal_rate" ~ "Formal Employment",
      employment_type == "informal_rate" ~ "Informal Employment",
      employment_type == "unemployment_rate" ~ "Unemployment"
    )
  )

fig4 <- plot_ly(trends_long,
                x = ~year,
                y = ~rate,
                color = ~employment_type,
                colors = c("Formal Employment" = "#00689D",
                          "Informal Employment" = "#E5243B",
                          "Unemployment" = "#333333"),
                type = 'scatter',
                mode = 'lines+markers',
                line = list(width = 3),
                marker = list(size = 10),
                frame = ~year,
                text = ~paste("Year:", year,
                             "<br>", employment_type, ":", round(rate, 1), "%"),
                hoverinfo = 'text') %>%
  animation_opts(frame = 600,
                transition = 400,
                redraw = FALSE) %>%
  animation_slider(currentvalue = list(
    prefix = "Year: ",
    font = list(color = "black", size = 16)
  )) %>%
  animation_button(label = "Play Animation") %>%
  layout(title = list(text = "<b>Employment Trends in Kenya (2010-2020)</b><br><sub>Slow formalization of the workforce</sub>",
                      x = 0),
         xaxis = list(title = "Year",
                     gridcolor = '#E8E8E8'),
         yaxis = list(title = "Percentage of Workforce (%)",
                     gridcolor = '#E8E8E8'),
         legend = list(title = list(text = '<b>Employment Type</b>')),
         plot_bgcolor = '#F5F5F5',
         paper_bgcolor = 'white')

fig4
```

---

## üìä Analysis 5: Health Access Comparison Heatmap

```{r health-heatmap, fig.height=7}
# Create comparison heatmap
comparison_matrix <- employment_data %>%
  group_by(employment_type) %>%
  summarise(
    `Insurance Coverage` = mean(insurance_coverage),
    `Can Afford Care` = mean(can_afford_care),
    `Monthly Earnings` = mean(avg_earnings) / 10,  # Scale for visibility
    .groups = "drop"
  ) %>%
  column_to_rownames("employment_type") %>%
  as.matrix()

fig5 <- plot_ly(z = ~comparison_matrix,
                x = ~colnames(comparison_matrix),
                y = ~rownames(comparison_matrix),
                type = "heatmap",
                colorscale = "Viridis",
                text = ~round(comparison_matrix, 1),
                texttemplate = "%{text}",
                hovertemplate = paste('%{y}<br>',
                                     '%{x}: %{z:.1f}<br>',
                                     '<extra></extra>'),
                colorbar = list(title = "Value",
                               titleside = "right")) %>%
  layout(title = list(text = "<b>Health Access Indicators by Employment Type</b><br><sub>Darker = higher values</sub>",
                      x = 0),
         xaxis = list(title = ""),
         yaxis = list(title = ""),
         paper_bgcolor = 'white')

fig5
```

---

## üìä Analysis 6: Kenya Focus - Interactive Data Table

```{r kenya-table}
# Create detailed table for Kenya
kenya_data <- employment_data %>%
  filter(country == "Kenya") %>%
  mutate(
    workers_millions = proportion * 20,  # Assuming 20M workforce
    coverage_gap = 100 - insurance_coverage
  ) %>%
  select(
    `Employment Type` = employment_type,
    `% of Workforce` = proportion,
    `Estimated Workers (M)` = workers_millions,
    `Avg Earnings ($)` = avg_earnings,
    `Insurance Coverage (%)` = insurance_coverage,
    `Coverage Gap (%)` = coverage_gap,
    `Can Afford Care (%)` = can_afford_care
  ) %>%
  mutate(across(where(is.numeric), ~round(., 1)))

datatable(kenya_data,
          options = list(
            pageLength = 5,
            dom = 'Bfrtip',
            buttons = c('copy', 'csv', 'excel'),
            scrollX = TRUE
          ),
          extensions = 'Buttons',
          caption = "Table 1: Employment and Health Access in Kenya (Interactive & Downloadable)",
          rownames = FALSE) %>%
  formatStyle('Coverage Gap (%)',
              backgroundColor = styleInterval(c(30, 60),
                                             c('#4C9F38', '#FD6925', '#E5243B')))
```

---

## üîç Key Findings

::: {.callout-note icon=false}
## üìå Main Findings

1. **Informal Sector Dominance**: 75-85% of East African workers are in informal employment

2. **Insurance Gap**: Formal workers have 3x higher health insurance coverage than informal workers

3. **Affordability Crisis**: Only 25% of informal casual workers can afford healthcare when needed

4. **Earnings Disparity**: Formal full-time workers earn 5-8x more than informal casual workers

5. **Slow Formalization**: Kenya's formal employment rate growing by only 0.5% per year

6. **Kenya's Challenge**: 16+ million informal workers lack employer-sponsored health coverage
:::

---

## üí° Policy Implications

### Expanding Health Coverage to Informal Workers

1. **Health Insurance Reforms**
   - Subsidized premiums for informal workers
   - Mobile money integration for contributions
   - Simplified enrollment processes

2. **Social Protection Extension**
   - Universal health coverage implementation
   - Community-based insurance schemes
   - Cash transfer programs for poorest

3. **Labor Market Interventions**
   - Formalization incentives for employers
   - Skills training for informal workers
   - Job creation in formal sector

4. **Behavioral Economics Insights**
   - Reduce transaction costs for insurance enrollment
   - Default enrollment with opt-out option
   - Peer influence and community mobilization

---

## üî¨ Research Questions for PhD

### Household-Level Analysis

1. **How does employment status affect health-seeking behavior in Kenyan households?**
   - Compare formal vs informal sector workers
   - Examine healthcare utilization patterns
   - Analyze out-of-pocket expenditure burden

2. **What is the causal effect of job loss on health outcomes?**
   - Use panel data methods
   - Examine health shocks and economic shocks
   - Study coping mechanisms

3. **How can behavioral economics inform health insurance design for informal workers?**
   - Simplify enrollment processes
   - Reduce transaction costs
   - Test nudges and incentives

4. **What role do labor market policies play in achieving UHC?**
   - Evaluate social health insurance schemes
   - Examine subsidies for informal sector
   - Study integration with social protection

---

## üìö Key References

- ILO. (2018). *Women and Men in the Informal Economy: A Statistical Picture*.
- Amu, H., et al. (2020). "Understanding variations in health insurance coverage in Ghana, Kenya, Nigeria, and Tanzania." *PLOS ONE*.
- Kenya National Bureau of Statistics. (2019). *Kenya Integrated Household Budget Survey*.
- World Bank. (2020). *Kenya Economic Update: Navigating the Pandemic*.

---

*This analysis examines the critical link between employment and health access, with direct implications for health financing policy in countries with large informal sectors like Kenya. The interactive visualizations enable deeper exploration of labor market-health relationships.*
